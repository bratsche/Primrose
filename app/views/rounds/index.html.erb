<%= link_to "Originals", "/", :id => "original" %>
<%= link_to "Highest/Lowest", "#", :id => "highlow" %>
<%= link_to "Randomize", "#", :id => "randomize" %>

<%= render :partial => "round", :collection => @rounds %>

<script type="text/javascript">
  function recalcAverages() {
    $("tr.participant").each(function() {
      var vals = $(this).children("td.score").filter(function(index) { return !$(this).hasClass("dropped"); });

      var sum = 0;
      $.each(vals, function() { sum += parseFloat(this.innerHTML); });
      var avg = Math.round(sum / vals.length * 10) / 10;

      $(this).children("td.avg")[0].innerHTML = avg;
    });
  }

  $(function() {
    $("table.sortable").tablesorter();

    $("a#highlow").bind("click", function () {
      $("tr.participant").each(function(index) {
        var vals = $(this).children("td.score").map(function() { return parseFloat(this.innerHTML); }).sort();
        var drops = [ vals[0], vals[vals.length - 1] ];

        $(this).children().each(function(c) {
          $(this).removeClass("dropped");
          if (drops.indexOf(parseFloat(this.innerHTML)) != -1) {
            $(this).addClass("dropped");
            var idx = drops.indexOf(parseFloat(this.innerHTML));
            if (idx != -1)
              drops.splice(idx, 1);
          }
        });
      });

      recalcAverages();

      return false;
    });

    $("randomize").bind("click", function () {
      return false;
    });
  });
</script>
